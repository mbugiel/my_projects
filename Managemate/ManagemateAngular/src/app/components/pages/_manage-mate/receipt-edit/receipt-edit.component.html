
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<div *ngIf="!is_Loaded_Order || !is_Loaded_Items || !is_Loaded_Edited || !is_Loaded_Receipt" class="loader-page">
    <div class="loader"></div>
</div>

<h3 *ngIf="is_Loaded_Receipt && is_Loaded_Items && is_Loaded_Order && items_count==0" class="errorHeader">{{ "receiptEdit.errors.itemListNotFound" | translate }}</h3>

<section class="outer-main" *ngIf="is_Loaded_Items && is_Loaded_Order && is_Loaded_Receipt">

    <header>

        <div class="header-content">

            <h3>{{"receiptEdit.receiptEdit" | translate}}</h3>

            @if(!editing_receipt.in_out){

                <h3 class="color-red">{{"receiptEdit.receiptIn" | translate}}</h3>
            }
            @else {

                <h3 class="color-green">{{"receiptEdit.receiptOut" | translate}}</h3>
            
            }
                
            <span>{{"receiptEdit.receiptAddHeader" | translate}}</span>
            <h3>
                {{order.order_name}}
            </h3>

        </div>

        <div class="header-content">
                
            <label>
                <mat-form-field [formGroup]="receipt_form">
                    <mat-label>{{ "orderEdit.creationDate" | translate }}</mat-label>
                    <input type="datetime-local" matInput #inputCreationDate formControlName="inputCreationDate">
                </mat-form-field>
            </label>

        </div>

    </header>



    <section class="receipt-form" [formGroup]="receipt_form">

        <label>
            <mat-form-field>
                <mat-label>{{ "receiptEdit.element" | translate }}</mat-label>
                <input matInput #inputElement formControlName="inputElement">
            </mat-form-field>
        </label>

        <label>
            <mat-form-field>
                <mat-label>{{ "receiptEdit.transport" | translate }}</mat-label>
                <input matInput #inputTransport formControlName="inputTransport">
            </mat-form-field>
        </label>

        <div class="button-container">
            
            @if(editing_receipt.in_out){

                <button (click)="open_select_item_dialog('100ms', '100ms', true)" class="margin-right color-green color-green-hover btn">{{ 'receiptEdit.itemAdd' | translate }}</button>

                <button (click)="open_select_item_dialog('100ms', '100ms', false)" class="margin-left color-navy color-navy-hover btn">{{ 'receiptEdit.itemService' | translate }}</button>

            }
            @else {
                
                <button (click)="open_select_item_dialog('100ms', '100ms', true)" class="color-red color-red-hover btn">{{ 'receiptEdit.itemReturn' | translate }}</button>

            }
            

        </div>

    </section>





    <section class="receipt-table">

        <table #items_on_receipt_table mat-table [dataSource]="items_on_receipt" matSort>

            <ng-container matColumnDef="row_count">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ "receiptEdit.itemNo" | translate }}</th>
                <td mat-cell *matCellDef="let i = index">{{i + 1}}</td>
            </ng-container>

            <ng-container matColumnDef="catalog_number">
                <th mat-header-cell *matHeaderCellDef mat-sort-header >{{ "receiptEdit.itemCatNum" | translate }}</th>
                <td mat-cell *matCellDef="let item">{{item.catalog_number}}</td>
            </ng-container>

            <ng-container matColumnDef="product_name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header >{{ "receiptEdit.itemName" | translate }}</th>
                <td mat-cell *matCellDef="let item">{{item.product_name}}</td>
            </ng-container>

            <ng-container matColumnDef="counting_type">
                <th mat-header-cell *matHeaderCellDef mat-sort-header >{{ "receiptEdit.itemCountingType" | translate }}</th>
                <td mat-cell *matCellDef="let item">{{item.counting_type}}</td>
            </ng-container>

            <ng-container matColumnDef="count">
                <th mat-header-cell *matHeaderCellDef mat-sort-header >{{ "receiptEdit.itemCount" | translate }}</th>
                <td mat-cell *matCellDef="let item">{{item.count}}</td>
            </ng-container>

            <ng-container matColumnDef="weight_kg">
                <th mat-header-cell *matHeaderCellDef mat-sort-header >{{ "receiptEdit.itemWeight" | translate }}</th>
                <td mat-cell *matCellDef="let item">{{item.weight_kg}}</td>
            </ng-container>

            <ng-container matColumnDef="summary_weight">
                <th mat-header-cell *matHeaderCellDef mat-sort-header >{{ "receiptEdit.itemSummaryWeight" | translate }}</th>
                <td mat-cell *matCellDef="let item">{{item.summary_weight.toFixed(4)}}</td>
            </ng-container>

            <ng-container matColumnDef="comment">
                <th mat-header-cell *matHeaderCellDef mat-sort-header><mat-icon class="warning">warning</mat-icon></th>
                <td mat-cell *matCellDef="let item">{{item.comment}}</td>
            </ng-container>           



            <ng-container matColumnDef="delete">
                <th mat-header-cell *matHeaderCellDef>{{ "itemList.delete" | translate }}</th>
                <td mat-cell *matCellDef="let item">
                    <button mat-raised-button (click)="open_delete_dialog('100ms', '100ms', item.id, item.product_name)">
                        <mat-icon class="delete">delete</mat-icon>
                        {{ "itemList.delete" | translate }}
                    </button>
                </td>
            </ng-container>

            <tr class="table-header" mat-header-row *matHeaderRowDef="columns_To_Display"></tr>
            <tr mat-row *matRowDef="let myRowData; columns: columns_To_Display"></tr>
      
    
        </table>

        <h3 *ngIf="is_Loaded_Items && is_Loaded_Order && items_on_receipt_count==0" class="errorHeader">{{ "receiptEdit.errors.itemsOnReceiptNotFound" | translate }}</h3>

    </section>






    <section class="receipt-form" [formGroup]="receipt_form">

        <div class="receipt-footer">
            <span>{{ "receiptEdit.SummaryWeight" | translate }}</span>
            <b>{{summary_weight}}</b>
        </div>

        <label>
            <mat-form-field>
                <mat-label>{{ "receiptEdit.comment" | translate }}</mat-label>
                <textarea matInput #inputComment formControlName="inputComment"></textarea>
            </mat-form-field>
        </label>

    </section>


    <div class="save-button">

        <span class="color-red padding-x" *ngIf="items_on_receipt.data.length == 0 && submitted">
            {{ "receiptEdit.errors.itemListNotFound" | translate }}
        </span>

        <span class="color-red padding-x" *ngIf="receipt_form.invalid && submitted">
            {{ "orderAdd.errors.formError" | translate }}
        </span>

        <button type="submit" class="color-green color-green-hover btn" (click)="edit_receipt()">
            {{"receiptEdit.buttonSave" | translate}}
        </button>
        
    </div>



</section>