<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Kebabook</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="logo-kebabook-small.ico">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <content-Security-Policy enabled="true">
        <script-src self="true">
          <add source="maps.googleapis.com"/>            
        </script-src>
        <connect-src self="true">
          <add source="maps.googleapis.com"/>            
        </connect-src>
    </content-Security-Policy>
</head>
<body>

    <div class="left"></div>

    <div class="middle">

        <header>
            <img class="logo-kebabook" src="logo-kebabook.png" alt="logo-kebabook" width="250">
            
            <nav class="navbar">
                <a href="index.html">Dodaj Kebabownię</a>
                <a href="znajdz.html">Znajdź Kebabownię</a>
                <a href="lokalizacja.html">Kebabownie w pobliżu</a>
                <a href="wszystkie.html">Wszystkie Kebabownie</a>
            </nav>
        </header>

        <section class="middle-bottom">

            <div class="middle-bottom-inner">

                <section class="kebab-form">
    
                    <h4>Nazwa Kebabowni:</h4>
    
                    <input placeholder="Nazwa" type="text" id="name">
    
                    <h4>Rodzaj jedzonego kebaba:</h4>
    
                    <div class="radio-container">
                        <label>Rollo<input type="radio" checked value="0" id="type" name="type"></label>
                        <label>W Bułce<input type="radio" value="1" id="type" name="type"></label>
                        <label>Na talerzu<input type="radio" value="2" id="type" name="type"></label>
                    </div>
    
                    <h4>Ocena jedzonego kebaba:</h4>
    
                    <label>
                        1<input value="3" type="range" id="grade" step="1" min="1" max="5">5
                    </label>
    
                    <h4>Komentarz dotyczący kebabowni:</h4>
    
                    <textarea id="comment" placeholder="Napisz tutaj swój komentarz..." maxlength="1000"></textarea>
    
                    <input type="button" value="Dodaj" id="submit-button">
    
                    <div id="box"></div>
    
                </section>
    
    
    
                <section class="kebab-location">
    
                    <h4>Lokalizacja Kebabowni:</h4>
    
                    <div id="google-map"></div>
    
                    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRbvZtyZ6-MCtHb9rttISAddY-6ehdoHo&loading=async&callback=initMap"></script>
                    <script>
    
                        let latitude, longitude;
    
    
                        function showError(error) {
    
                          switch(error.code) {
    
                            case error.PERMISSION_DENIED:
                            
                              let location = {lat: 53.12255, lng: 18.0051985};
    
                              showMap(location);
                            
                              break;
    
                            case error.POSITION_UNAVAILABLE:
                              alert("Informacja o lokalizacji jest niedostępna.");
                              break;
    
                            case error.TIMEOUT:
                              alert("Zapytanie o lokalizację wygasło.");
                              break;
    
                            case error.UNKNOWN_ERROR:
                              alert("Wystąpił nieznany błąd.");
                              break;
    
                          }
    
                        }
    
                        function showMap(location){
    
                            
                            let map = new google.maps.Map(
                                document.getElementById('google-map'), {zoom: 10, center: location, mapId: 'DEMO_MAP_ID'}
                            );
    
                            const infoWindow = new google.maps.InfoWindow();
    
                            let advancedMarker = new google.maps.marker.AdvancedMarkerElement({
                                                    map: map,
                                                    position: location,
                                                    gmpDraggable: true,
                                                    });
    
                            infoWindow.close();
                            infoWindow.setContent(
                            `Lokalizacja Kebabowni: ${location.lat}, ${location.lng}`,
                            );
                            infoWindow.open(advancedMarker.map, advancedMarker);
    
                            latitude = location.lat;
                            longitude = location.lng;
    
                            advancedMarker.addListener("dragend", (event) => {
    
                                const position = advancedMarker.position;
    
                                latitude = position.lat;
                                longitude = position.lng;
    
                                infoWindow.close();
                                infoWindow.setContent(
                                `Lokalizacja Kebabowni: ${position.lat}, ${position.lng}`,
                                );
                                infoWindow.open(advancedMarker.map, advancedMarker);
    
                            });
                              
    
                        }
    
    
                        function initMap(){
    
                            const { AdvancedMarkerElement } = google.maps.importLibrary("marker");
    
    
                            let location = {lat: -25.334, lng: 131.036};
    
                            if (navigator.geolocation) {
    
                                navigator.geolocation.getCurrentPosition(function(position){
    
                                    //console.log(position.coords.latitude + "   "+position.coords.longitude)
    
                                    location.lat = position.coords.latitude;
                                    location.lng = position.coords.longitude;
    
                                    showMap(location);
    
                                    //console.log(location);
    
                                                      
    
                                }, showError);
                                
    
                            }
    
                            
    
                        }
                    </script>
    
                </section>


            </div>


        </section>

    </div>

    <div class="right"></div>


    <div id="loader-container">
        
        <div class="loader"></div>

    </div>

        
</body>
</html>

<script>

    $("#submit-button").click(function() {

        if($("#name").val() == ""){
            
            $("#box").html("<b>Błąd!<br> </b>Nazwa Kebabowni jest wymagana.");
            $("#box").css("display", "block");
            $("#box").css("background-color", "red");

            setTimeout(function(){
                $("#box").css("display", "none");


            }, 4000);

            return;

        }


        $("#loader-container").css("display", "flex");

        var name = $('#name').val();
        var type = $("input[name = 'type']:checked").val();
        console.log(type);
        var grade = $("#grade").val();
        var comment = $("#comment").val() ? $("#comment").val() : null;

        if(comment){
            
            
            $.ajax({                 // /PSI13/		
                url: "http://localhost/Zadanie%2013/test.php?name="+name+"&type="+type+"&grade="+grade+"&latitude="+latitude+"&longitude="+longitude+"&comment="+comment, 
                method : "get",
                dataType : "json",
            
                success : function(response) {
                
                    console.log(response);

                    let responseTXT="";
			        if (response.length!=0){//jeśli wróciło coś więcej niż 0
			        	
                        responseTXT += response[0].value;

			        	$("#box").html("<b>Odpowiedz serwera:<br> </b>"+responseTXT);
                        $("#box").css("display", "block");
                        $("#box").css("background-color", response[0].color);

                        setTimeout(function(){
                            $("#box").css("display", "none");


                        }, 4000);
			        }

                    $("#loader-container").css("display", "none");
                
                },
                error: (err) => {
                    $("#loader-container").css("display", "none");
                    alert(err.error);
                }
            });
        }else{

            
            $.ajax({ 			     // /PSI13/			
                url: "http://localhost/Zadanie%2013/test.php?name="+name+"&type="+type+"&grade="+grade+"&latitude="+latitude+"&longitude="+longitude, 
                method : "get",
                dataType : "json",
            
                success : function(response) {
                
                    console.log(response);

                    let responseTXT="";
			        if (response.length!=0){//jeśli wróciło coś więcej niż 0
			        	
                        responseTXT += response[0].value;

			        	$("#box").html("<b>Odpowiedz serwera:<br> </b>"+responseTXT);
                        $("#box").css("display", "block");
                        $("#box").css("background-color", response[0].color);

                        setTimeout(function(){
                            $("#box").css("display", "none");
                            

                        }, 4000);
			        }

                    $("#loader-container").css("display", "none");

                },
                error: (err) => {
                    $("#loader-container").css("display", "none");
                    alert(err.error);
                }
                
            });

        }
            

    });

</script>